<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    
    <style>
        body{
            margin: 10px 120px;
            padding: 0;
            background-color: antiquewhite;
            display: flex;
            justify-content: center;
        }
        .card_left{
            width:240px;
            margin: 80px 0 0 0;
            background-color: white;
            border: gray solid 1px;
            height: 800px;
            display: inline-block;
            border-radius: 30px 0 0 30px;
            
        }
        .card_right{
            width:600px;
            background-color: white;
            height: 800px;
            margin: 80px 0 0 0;
            display: inline-block;
            border: gray solid 1px;
            border-radius: 0 30px 30px 0;
         
        }
        .card_left_head{
            margin:60px 35px 0 0;
            height: 60px;
            border-radius: 60px;
            text-align: center;
            padding: 40px;
            background-color: blanchedalmond;
        }
        .card_left_body{
            height: 800px;
            text-align: left;
        }
        .card_right_body_conect{
            padding: 10px;
        }
        .h2{
            color: blue;
            padding: 10px 5px;
            border-bottom:3px solid blue ;
        }
        #name{}
        #id{}
        #phone{}
        #email{}
        #git{}
        #intro{}
        #edu{}
        #program{}
        #shuanxing{
            width: 40px;
            height: 60px;
            border-radius: 30px;
        }
    </style>

    
</head>
<body>
    <button id="shuanxing">刷新</button>
    <div class="card_left">
        <div class="card_left_head"> <img src=https://picsum.photos/id/64/80/100></div>
        <div class="card_left_body">
            <h2 id="name">加载中...</h2>
            <p id="id"></p>
            <p id="phone"></p>
            <p id="email"></p>
            <p id="git"></p>
        </div>
    </div>
    <div class="card_right">
        <div class="card_right_body_conect">
            <div class="card_right_body_conect">
                <h2 class="h2">个人简介</h2>
                <p id="intro">正在加载中ing</p>
            </div>
            <div class="card_right_body_conect">
                <h2 class="h2">教育背景</h2>
                <P id="edu">正在加载中ing</P>
            </div>
            <div class="card_right_body_conect">
                <h2 class="h2">项目经历</h2>
                <p id="program">正在加载中ing</p>
            </div>
        </div>
    </div>
    <script>
        let id1='';
        let ws=null;
        const URL = 'https://teaching.ncuos.com';
    async function set_base(){
        try{ 
        const res1=await fetch(`${URL}/baseInfo`);
        if(!res1.ok){
            throw new Error('嘻嘻，没找到呢')
        }
        const data=await res1.json();
        id1=data.id;
        document.getElementById("name").textContent=data.name;
        document.getElementById("phone").textContent="电话号码："+data.phone;
    document.getElementById('git').textContent = "github："+data.githubLink;
        document.getElementById("email").textContent="email："+data.email;
         await Promise.all([set_intro(), set_edu(), set_proj()]);
        }catch  (e){
            console.error(e.message);
        }

 }
    async function set_intro(){
        try{
            const res2=await fetch(`${URL}/selfIntroduction?id=${id1}`);
            if(!res2.ok)throw new Error("嘻嘻");
            const data2=await res2.json();
            document.getElementById("intro").textContent=data2.selfIntroduction;
        }catch (e){
            console.error(e.message);
        }
    }
        
    async function set_edu(){
        try{
            const res3=await fetch(`${URL}/eduExperience`,{
                method:'POST',
                headers:{'Content-Type':'application/json'},
                body:JSON.stringify({id:id1})
            });
            if(!res3.ok)throw new Error("666");
            const data3=await res3.json();
            document.getElementById("edu").textContent=data3.eduBackground;
        }catch (e){
            console.error(e.message);
        }
    }
     function set_proj(){
        if(ws){ws.close()}
        ws =new WebSocket(`wss://teaching.ncuos.com/projectExperience/basicWS`);
        ws.onmessage=e=>{
            try{
                const proj=JSON.parse(e.data);
                document.getElementById("program").innerHTML=`<h3>${proj.name}||${proj.title}</h3><p>${proj.description}</p>`;
            }catch (err){
                console.error(err);
            }
        }
         ws.onerror=()=>console.error("链接失败");
    }
    window.onload=()=>set_base();
    document.getElementById("shuanxing").addEventListener("click",function(){
        set_base();
    });
    </script>
</body>
</html>